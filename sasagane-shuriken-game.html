<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ãƒ‹ãƒ³ã‚¸ãƒ£æ‰‹è£å‰£ã‚²ãƒ¼ãƒ </title>
  <meta name="description" content="ã‚¿ãƒƒãƒ—/ã‚¯ãƒªãƒƒã‚¯ã§æ‰‹è£å‰£ã‚’æ”¾ã¡ã€æ¨™çš„ã‚’å€’ã—ã¦ã‚¹ã‚³ã‚¢ã‚’ç«¶ã†ãƒ©ã‚¤ãƒˆã‚¦ã‚§ã‚¤ãƒˆãªãƒŸãƒ‹ã‚²ãƒ¼ãƒ ã€‚" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Zen+Old+Mincho:wght@600;700;900&family=Shippori+Mincho:wght@500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-dark: #0b0b12;
      --ink: #f8fafc;
      --accent: #d946ef;
      --accent2: #f43f5e;
      --gold: #fbbf24;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: radial-gradient(1200px 800px at 50% 30%, rgba(212,70,239,0.12), transparent 60%),
                  linear-gradient(180deg, #100818, #0b0b12 40%);
      color: var(--ink);
      font-family: 'Shippori Mincho', 'Zen Old Mincho', serif;
      overflow: hidden;
    }
    .topbar {
      position: fixed; inset: 0 0 auto 0; height: 56px; display: flex; align-items: center; gap: 16px;
      padding: 0 16px; background: rgba(0,0,0,0.35); backdrop-filter: blur(6px); border-bottom: 1px solid rgba(212,70,239,0.25);
      z-index: 10;
    }
    .title { font-weight: 700; letter-spacing: .08em; }
    .pill { display: inline-flex; align-items: center; gap: 8px; padding: 6px 12px; border:1px solid rgba(255,255,255,0.25); border-radius: 999px; font-size: 12px; }
    .accent { border-color: rgba(212,70,239,0.6); color: var(--accent); }
    .gold { border-color: rgba(251,191,36,0.6); color: var(--gold); }
    .canvas-wrap { position: absolute; inset: 56px 0 0 0; }
    canvas { width: 100%; height: 100%; display: block; }
    .overlay { position: absolute; inset: 56px 0 0 0; display: grid; place-items: center; pointer-events: none; }
    .panel { pointer-events: auto; text-align: center; padding: 24px 20px; background: rgba(0,0,0,0.55); border:1px solid rgba(212,70,239,0.35); border-radius: 16px; max-width: 480px; margin: 0 16px; }
    .panel h1 { margin: 0 0 8px; font-family: 'Zen Old Mincho', serif; font-weight: 900; }
    .panel p { margin: 6px 0; opacity: .9; }
    .btn { display: inline-block; padding: 12px 20px; border-radius: 999px; color: var(--ink); text-decoration: none; border: 2px solid var(--accent); }
    .btn:hover { background: linear-gradient(45deg, var(--accent), var(--accent2)); border-color: transparent; }
    .hint { font-size: 12px; opacity: .7; margin-top: 6px; }
  </style>
  <script>
    // è»½é‡Canvasã‚²ãƒ¼ãƒ ï¼ˆãƒ¢ãƒã‚¤ãƒ«å„ªå…ˆè¨­è¨ˆï¼‰
    window.addEventListener('DOMContentLoaded', () => {
      const isMobile = window.innerWidth <= 768 || /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);

      const canvas = document.getElementById('g');
      const ctx = canvas.getContext('2d', { alpha: false });
      let W = 0, H = 0, dpr = Math.min(window.devicePixelRatio || 1, isMobile ? 1.5 : 2);

      function resize() {
        W = canvas.clientWidth | 0; H = canvas.clientHeight | 0;
        canvas.width = (W * dpr) | 0; canvas.height = (H * dpr) | 0;
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      }
      const ro = new ResizeObserver(resize); ro.observe(canvas);

      // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
      let state = 'ready'; // ready | playing | ended
      let score = 0; let timeLeft = 30; // ç§’
      let lastTick = 0; let acc = 0; // ã‚¿ã‚¤ãƒãƒ¼ç”¨
      let targets = [];
      let throws = []; // æ‰‹è£å‰£ã‚¢ãƒ‹ãƒ¡
      const maxTargets = isMobile ? 5 : 8;
      const shurikenSpeed = isMobile ? 900 : 1100; // px/s
      const targetSpeed = isMobile ? 36 : 48; // px/sï¼ˆã‚†ã£ãã‚Šï¼‰
      const targetRadius = 18;

      function spawnTarget() {
        if (targets.length >= maxTargets) return;
        const side = Math.random() < 0.5 ? 'left' : 'right';
        const y = 80 + Math.random() * Math.max(120, H - 200);
        const x = side === 'left' ? -30 : W + 30;
        const vx = side === 'left' ? (targetSpeed + Math.random()*12) : -(targetSpeed + Math.random()*12);
        targets.push({ x, y, vx, r: targetRadius });
      }

      function start() {
        score = 0; timeLeft = 30; state = 'playing';
        lastTick = performance.now(); acc = 0; targets = []; throws = [];
        for (let i=0;i<maxTargets-2;i++) spawnTarget();
        document.getElementById('panel').style.display = 'none';
      }

      function end() {
        state = 'ended';
        const panel = document.getElementById('panel');
        panel.style.display = 'block';
        panel.querySelector('h1').textContent = 'è©¦åˆçµ‚äº†';
        panel.querySelector('.desc').innerHTML = `ã‚¹ã‚³ã‚¢: <b>${score}</b> ç‚¹`;
        panel.querySelector('.btn').textContent = 'ã‚‚ã†ä¸€åº¦';
      }

      function tap(e) {
        if (state !== 'playing') return;
        const rect = canvas.getBoundingClientRect();
        const tx = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
        const ty = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
        // æ‰‹è£å‰£ã‚’ä¸‹ä¸­å¤®ã‹ã‚‰æ”¾ã¤
        const sx = W*0.5, sy = H - 10;
        const dx = tx - sx, dy = ty - sy; const len = Math.hypot(dx, dy) || 1;
        const vx = (dx/len) * shurikenSpeed; const vy = (dy/len) * shurikenSpeed;
        throws.push({ x: sx, y: sy, vx, vy, life: 0.6 });
      }

      canvas.addEventListener('click', tap, { passive: true });
      canvas.addEventListener('touchstart', tap, { passive: true });

      function update(dt) {
        // ã‚¿ã‚¤ãƒãƒ¼
        acc += dt; while (acc >= 1) { acc -= 1; timeLeft -= 1; if (timeLeft <= 0) { end(); break; } }

        // æ¨™çš„æ›´æ–°
        for (const t of targets) {
          t.x += t.vx * dt;
        }
        // ç”»é¢å¤–ã¯å†é…ç½®
        targets = targets.filter(t => t.x > -60 && t.x < W + 60);
        while (state==='playing' && targets.length < maxTargets) spawnTarget();

        // æ‰‹è£å‰£æ›´æ–°
        for (const s of throws) {
          s.x += s.vx * dt; s.y += s.vy * dt; s.life -= dt;
          // å½“ãŸã‚Šåˆ¤å®šï¼ˆæœ€è¿‘å‚ãƒ’ãƒƒãƒˆï¼‰
          for (let i=0;i<targets.length;i++) {
            const t = targets[i];
            const d = Math.hypot(t.x - s.x, t.y - s.y);
            if (d <= t.r + 8) {
              // ãƒ’ãƒƒãƒˆ
              score += 1; targets.splice(i,1); s.life = Math.min(s.life, 0.15);
              break;
            }
          }
        }
        throws = throws.filter(s => s.life > 0 && s.x>-40 && s.x<W+40 && s.y>-40 && s.y<H+40);
      }

      function draw() {
        ctx.fillStyle = '#0b0b12';
        ctx.fillRect(0,0,W,H);

        // è£…é£¾ã‚°ãƒªãƒƒãƒ‰
        ctx.strokeStyle = 'rgba(255,255,255,0.04)'; ctx.lineWidth = 1;
        for (let x=0;x<W;x+=40) { ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,H); ctx.stroke(); }
        for (let y=0;y<H;y+=40) { ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(W,y); ctx.stroke(); }

        // ã‚¹ã‚³ã‚¢/ã‚¿ã‚¤ãƒ 
        ctx.fillStyle = '#f8fafc'; ctx.font = '600 16px \"Shippori Mincho\"';
        ctx.fillText(`å¾—ç‚¹ ${score}`, 12, 24);
        ctx.fillStyle = '#fbbf24'; ctx.fillText(`æ®‹ã‚Š ${Math.max(0,timeLeft)} ç§’`, 12, 46);

        // æ¨™çš„
        for (const t of targets) {
          const grad = ctx.createRadialGradient(t.x, t.y, 4, t.x, t.y, t.r);
          grad.addColorStop(0, 'rgba(217,70,239,0.9)');
          grad.addColorStop(1, 'rgba(217,70,239,0.2)');
          ctx.fillStyle = grad; ctx.beginPath(); ctx.arc(t.x, t.y, t.r, 0, Math.PI*2); ctx.fill();
          ctx.strokeStyle = 'rgba(244,63,94,0.7)'; ctx.lineWidth = 2; ctx.stroke();
        }

        // æ‰‹è£å‰£ï¼ˆç°¡æ˜“ï¼‰
        for (const s of throws) {
          ctx.save(); ctx.translate(s.x, s.y);
          const a = (performance.now()/120) % (Math.PI*2); ctx.rotate(a);
          ctx.strokeStyle = 'rgba(248,250,252,0.9)'; ctx.lineWidth = 2;
          ctx.beginPath();
          ctx.moveTo(0,-10); ctx.lineTo(0,10); ctx.moveTo(-10,0); ctx.lineTo(10,0);
          ctx.stroke();
          ctx.restore();
        }
      }

      // ãƒ«ãƒ¼ãƒ—ï¼ˆãƒ¢ãƒã‚¤ãƒ«ã¯30FPSä¸Šé™ï¼‰
      let last = performance.now();
      const frame = isMobile ? (1000/30) : (1000/60);
      let accFrame = 0;
      function loop(now){
        const dtRaw = (now - last) / 1000; last = now;
        accFrame += dtRaw*1000;
        if (accFrame >= frame) {
          const dt = Math.min(accFrame/1000, 0.05); // å®‰å®šåŒ–
          accFrame = 0;
          if (state === 'playing') update(dt);
          draw();
        }
        requestAnimationFrame(loop);
      }
      requestAnimationFrame(loop);

      // ãƒ‘ãƒãƒ«è¨­å®š
      document.getElementById('start').addEventListener('click', start);
      // åˆå›æç”»
      resize(); draw();
    });
  </script>
</head>
<body>
  <div class="topbar">
    <div class="title">ãƒ‹ãƒ³ã‚¸ãƒ£æ‰‹è£å‰£ã‚²ãƒ¼ãƒ </div>
    <div class="pill accent">ğŸ¥· æ‰‹è£å‰£ã§çš„ã‚’è¨ã¦</div>
    <div class="pill gold">åˆ¶é™æ™‚é–“ 30 ç§’</div>
  </div>
  <div class="canvas-wrap"><canvas id="g"></canvas></div>
  <div class="overlay">
    <div class="panel" id="panel">
      <h1>ãƒ‹ãƒ³ã‚¸ãƒ£æ‰‹è£å‰£ã‚²ãƒ¼ãƒ </h1>
      <p class="desc">ç”»é¢ã‚’ã‚¿ãƒƒãƒ—/ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€çš„ã«å‘ã‘ã¦æ‰‹è£å‰£ã‚’æ”¾ã¦ã€‚<br>30ç§’ã§ä½•ç‚¹ã¨ã‚Œã‚‹ã‹æŒ‘æˆ¦ï¼</p>
      <p class="hint">ãƒ’ãƒ³ãƒˆ: çš„ã¯æ¨ªã«ã‚†ã£ãã‚Šå‹•ãã€‚ç‹™ã„ã‚’å°‘ã—å…ˆã«ç½®ã“ã†ã€‚</p>
      <a href="#" class="btn" id="start">é–‹å§‹ã™ã‚‹</a>
    </div>
  </div>
</body>
</html>

